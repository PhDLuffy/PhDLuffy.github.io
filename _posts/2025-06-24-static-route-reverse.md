---
layout: post
title: 子路由和主路由设备互通
subtitle: 又学会一招网络技能
date: 2025-06-24
author: PhDLuffy
header-img: img/header-img/6/24.jpg
music-id: 29802490
catalog: true
tags:
    - 软件

---

## 前言

*为何要设置主路由和子路由？*

为了设备隔离，为了特殊网络服务和正常网络服务解耦合。

主路由连接光猫，提供正常的网络服务，下属设备为家庭正常使用设备。

子路由连接主路由，不采用交换机模式(LAN接LAN)，采用主路由子路由模式(LAN接WAN)，

子路由提供特殊网络服务，子路由出问题并不影响主路由的网络服务，做到服务解耦合。

## 子路由和主路由的网络拓扑[^1]

由图可视，

主路由WAN口连接光猫，正常上网。

主路由LAN口连接子路由的WAN口。

子路由的LAN口连接其下属设备



此时的IP情况。

主路由的WAN口获得光猫拨号分发的公网IP

主路由的LAN口获得主路由DHCP分发的主路由网段ip，192.168.1.X网段，主路由IP为192.168.1.1

子路由的WAN口获得主路由DHCP分发的主路由网段ip，192.168.1.2

子路由的LAN口获得子路由DHCP分发的子路由网段，192.168.2.X网段，子路由IP为192.168.2.1

![image-20250624113414680](https://fastly.jsdelivr.net/gh/PhDLuffy/PicGo@master/img/202506241134779.png)

在这样的网络拓扑下，

正常情况下，子路由192.168.2.x网段设备，是可以访问同网段设备和主路由192.168.1.x网段设备

但是，主路由192.168.1.x网段设备，无法访问子路由192.168.2.1网段设备。

所以这时候就需要在主路由设置静态路由来实现这个功能。

## 静态路由

在主路由设备进行操作，

添加静态路由表，

主机ip，填写子路由网段，例如，192.168.2.0

网络掩码，255.255.255.0

网关，填写子路由的WAN口在主路由网段下的ip，例如，192.168.1.2



这样，主路由网段设备去寻找例如192.168.2.6打印机设备，

会首先去寻找192.168.1.2这个子路由网关(同时ip也是192.168.2.1)，然后再往下寻找192.168.2.6打印机设备。



这样，主路由和子路由就达成了设备互通。



## 特殊情况

在子路由具有特殊网络服务的情况下，子路由设备并不能自动向上访问主路由设备。

所有，要进行**反向静态路由**的设置，

方法与静态路由相似，



在子路由设备上进行操作，

添加静态路由表，

主机ip，填写主路由网段，例如，192.168.1.0

网络掩码，255.255.255.0

网关，填写主路由LAN口在子路由WAN口下的ip，例如，192.168.2.1



这样，子路由网段设备去寻找例如192.168.1.6的监控设备，

会首先去寻找192.168.2.1这个子路由网关(同时ip也是192.168.1.2)，然后再往上寻找192.168.1.6监控设备。



这样，在特殊情况下，子路由和主路由达成了设备互通。



![群晖下属设备访问主路由静态路由表设置界面](https://fastly.jsdelivr.net/gh/PhDLuffy/PicGo@master/img/202506241210792.png)



## 总结

静态路由表的核心就是两点，一是找到连接主路由和子路由的设备ip，也就是网关ip；二是确定主路由和子路由的网段；

设备首先寻找自己网段的网关设备，然后通过网关向上或向下跳转到另一个网段，寻找另一个网段的设备。

## 参考文献：

[^1]:[教大家用静态路由，访问子路由器下电脑文件共享和网络监控等设备_哔哩哔哩_bilibili](https://www.bilibili.com/video/BV1Xf4y1R7Rq/?spm_id_from=333.337.search-card.all.click&vd_source=ae43e31fa8b0a49f93dbb7dc012860f8)

